import $ from 'balajs';
import assign from 'object.assign';

CodeMirror.defineOption('jsonlint', false, function(editor, value) {
	let initialized = editor._jsonlint;
	//if(!value && !editor._jsonlint)
	if(value && !initialized) {
		let wrapper = editor.display.wrapper,
			_validateButton = assign(wrapper.appendChild($.one('<div>')), {
				className: 'lint-button'
			}),
			_notifierBlock = wrapper.appendChild(assign($.one('<div>'), {
				className: 'lint-notifier',
			}));

		assign(editor, { _notifierBlock, _validateButton });

		editor.on('change', () => {
			editor.highlightErrorLine(null);
			editor.notify(null);
		});

		_validateButton.addEventListener('click', evt => {
			editor.validate()
		});

		editor._jsonlint = true;
	} else if(!value && !initialized) {
		return;
	} else if(!value && initialized) {
		editor._notifierBlock.style.display = editor._validateButton.style.display = 'none';
	} else if(value && initialized) {
		editor._notifierBlock.style.display = editor._validateButton.style.display = '';
	}
});
